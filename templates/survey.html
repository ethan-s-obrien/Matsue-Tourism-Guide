{% extends "layout.html" %}

{% block title %}
    Survey
{% endblock %}

{% block main %}
<body>
        <h1 class="text-center" id="header">Answer to Find Your Journey</h1>
        <form method="POST" action="/survey">
            <div class="mb-3">
                <label for="question_1" class="form-label">How will you travel to Matsue?</label>
                <div class="d-flex justify-content-center">
                    <div>
                    <select class="form-select" id="question_1" name="question_1" required>
                        <option value="" disabled selected>Select</option>
                        <option value="bus">Bus</option>
                        <option value="plane">Plane</option>
                        <option value="train">Train</option>
                        <option value="car">Car</option>
                    </select>
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label for="question_2" class="form-label">How many of you will travel to Matsue?</label>
                <div class="d-flex justify-content-center">
                <select class="form-select" id="question_2" name="question_2" required>
                    <option value="" disabled selected>Select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="4+">4+</option>
                </select>
            </div>
            </div>
            <div class="mb-3">
                <label for="question_2" class="form-label">How long do you plan to be in Matsue for?</label>
                <div class="time-picker">
                    <label for="days">Days</label>
                    <select id="days">
                      <!-- Days options dynamically populated -->
                    </select>
                  
                    <label for="hours">Hours</label>
                    <select id="hours">
                      <!-- Hours options dynamically populated -->
                    </select>
                  </div>
            </div>

            <!-- Another example question -->
            <div class="mb-3">
                <label for="age-brackets" class="form-label">Please tell us the number of people in each age bracket in your group.</label>
                <div class="age-brackets" id="age-brackets" name="age-brackets" required>
                    <label for="0-9">0-9</label>
                    <select class="people-select">
                        <!-- no. of peeps automatically populated -->
                    </select>

                    <label for="10-19">10-19</label>
                    <select class="people-select">
                        <!-- no. of peeps automatically populated -->
                    </select>

                    <label for="20-29">20-29</label>
                    <select class="people-select">
                        <!-- no. of peeps automatically populated -->
                    </select>

                    <label for="30-39">30-39</label>
                    <select class="people-select">
                        <!-- no. of peeps automatically populated -->
                    </select>

                    <label for="40-49">40-49</label>
                    <select class="people-select">
                        <!-- no. of peeps automatically populated -->
                    </select>

                    <label for="50-59">50-59</label>
                    <select class="people-select">
                        <!-- no. of peeps automatically populated -->
                    </select>

                    <label for="60-69">60-69</label>
                    <select class="people-select">
                        <!-- no. of peeps automatically populated -->
                    </select>

                    <label for="70+">70+</label>
                    <select class="people-select">
                        <!-- no. of peeps automatically populated -->
                    </select>
                </div>
            </div>
                <h4>Please rank what kind of places you'd like to see.</h4>
                <ul id="drag-list" class="drag-list">
                    <li class="drag-item" draggable="true" data-value="Cultural">Cultural</li>
                    <li class="drag-item" draggable="true" data-value="Historic">Historic</li>
                    <li class="drag-item" draggable="true" data-value="Natural">Natural</li>
                </ul>
                <input type="hidden" name="preferences" id="preferences" value="">
                </div>
            </fieldset>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>
    <div class="alert alert-success mt-4" role="alert">
        Thank you for your feedback! You're now being redirected to your dashboard.
    </div>

    <script>
        const dragList = document.getElementById('drag-list');
        const hiddenInput = document.getElementById('preferences');
        let draggingItem = null;

        dragList.addEventListener('dragstart', (e) => {
            draggingItem = e.target;
            e.target.classList.add('dragging');
        });

        dragList.addEventListener('dragend', (e) => {
            e.target.classList.remove('dragging');
        });

        dragList.addEventListener('dragover', (e) => {
            e.preventDefault();
            const draggingOver = e.target.closest('.drag-item');
            if (draggingOver && draggingOver !== draggingItem) {
                const bounding = draggingOver.getBoundingClientRect();
                const offset = e.clientY - bounding.top;
                if (offset > bounding.height / 2) {
                    draggingOver.after(draggingItem);
                } else {
                    draggingOver.before(draggingItem);
                }
            }
        });

        // Populate options dynamically
        const daysSelect = document.getElementById('days');
        const hoursSelect = document.getElementById('hours');
        const peopleSelects = document.querySelectorAll('.people-select');

        // Populate days (e.g., 0 to 30 days)
        for (let i = 0; i <= 30; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `${i}`;
        daysSelect.appendChild(option);
        }

        // Populate hours (e.g., 0 to 23 hours)
        for (let i = 0; i < 24; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `${i}`;
        hoursSelect.appendChild(option);
        }

        // Populate each select element with the number of people to select in form
        peopleSelects.forEach(select=> {
            for (let i = 0; i < 10; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i}`;
                select.appendChild(option);
        }
    });

        // Update the hidden input value when the form is submitted
        document.getElementById('preference-form').addEventListener('submit', (e) => {
            const orderedItems = Array.from(dragList.children).map(item => item.dataset.value);
            hiddenInput.value = orderedItems.join(',');
        });
    </script>
    
</body>
{% endblock %}